<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="yaml.min.js"></script>
</head>
<body>
<div id="zone_respons"></div>
<script>
    var domain="http://localhost:5000";

    function getParams() {
        var vars = {};
        window.location.href.replace( location.hash, '' ).replace(
            /[?&]+([^=&]+)=?([^&]*)?/gi, // regexp
            function( m, key, value ) { // callback
                vars[key] = value !== undefined ? value : '';
            }
        );
        return vars;
    }

    function getSettings(func){
        func(YAML.load("settings.yaml"));
        //fetch().then((r)=>{r.json().then((json)=>{func(json)});});
    }

    function getToken(domain,username,password,func){
        fetch(domain+"/auth",{
                method:'POST',
                headers: new Headers({
                    "Content-Type":"application/json",
                    "Cache-Control":"no-cache",
                    "Accept":"*/*"
                }),
                body:JSON.stringify({
                    "username":username,
                    "password":password
                })
            }).then((r)=>{
                r.json().then((result)=>{func(result.access_token);})
            });
    }

    getSettings((settings)=>{
        var url=getParams()["server"]+":"+getParams()["port"];
        if(!url.startsWith("http"))url="http://"+url;
        getToken(url,"hhoareau@gmail.com","hh4271",(token)=>{
            fetch(url+"/"+settings.api.endpoint+"/dogs?limit=10&quality=true"
                ,{
                    headers:new Headers({'Authorization':"JWT "+token})
                }
            ).then((r)=>{
                r.json().then((result)=>{
                    var zone=document.getElementById("zone_respons");
                    if(result.length==0){
                        zone.innerHTML="Aucune r√©ponse";
                    } else {
                        for(let r of result){
                            zone.innerHTML+="<img src='"+r+"' style='width:200px'><br>";
                        }
                    }
                });
            });
        });
    });

</script>
</body>
</html>
